<!DOCTYPE html>
<html lang="ja-jp"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>HugoとNetlify CMSでブログを構築する - ゆり系</title>
    <base href="https://blog.yuri-k.com">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <link rel="stylesheet" href="https://blog.yuri-k.com/css/normalize.min.css">
    <link rel="stylesheet" href="https://blog.yuri-k.com/css/solarized-light.min.css">
    <link rel="stylesheet" href="https://blog.yuri-k.com/css/style.css">
</head>
<body><header>
    <nav class="breadcrumb">
        
        <a href="/">/Home</a>
        
        <a href="/post">/Posts</a>
        
    </nav>
</header>
<div class="container">
<main id="single">
    <h1>HugoとNetlify CMSでブログを構築する</h1>
    <h2><time datetime="2018-08-31T00:08:34&#43;0900">2018-08-31</time>
</h2>
    <section class="post-content">
        

<p>8月に会社を辞め、次の職場の出勤まで丸1ヶ月のおやすみ。無為に過ごすのもよくないのでとりあえずブログを立ち上げてみようと思いました。</p>

<p>ブログエンジンとしては、以前から業務にて使用していた静的サイトジェネレーターの「Hugo」を使い、かつNetlify CMSを用いてブラウザ上から記事の投稿もできるようにしてみます。</p>

<h1 id="hugoとは">Hugoとは？</h1>

<p>Hugoは静的サイトジェネレーターの一種です。</p>

<p>静的サイトジェネレーターは、テキストファイルで用意した原稿を元にHTMLを生成するアプリケーションで、Wordpressなどと異なりサーバーにインストールする必要がなく、SQLなどのDBも使わないため手軽で、セキュリティ面でも有利なため、最近人気が高まっています。</p>

<p>テキストファイルで原稿を作成し、CUIでコマンドを実行すると原稿をもとにHTMLが生成されます。基本的には生成されたHTMLをWebサーバーにアップロードすることで利用しますが、NetlifyやCircleCIなどのCIサービスと組み合わせてGitからの自動デプロイを実行することが多いようです。</p>

<h1 id="netlify-cmsとは">Netlify CMSとは？</h1>

<p>静的サイトジェネレーターは手軽な反面、コンテンツ管理という意味では貧弱ですし、GUIの記事作成画面も用意されないので、とっつきにくい部分もあります。CIサービスと組み合わせるならGitの知識も必要です。</p>

<p>そんな欠点を補うべく、静的サイトジェネレーターをWordpressなどの一般的なCMSライクに利用するためのソフトウェアが「Netlify CMS」です。Netlify CMSを利用することにより、HugoでもWebブラウザのGUIから記事投稿や画像アップロードが可能となります。</p>

<p>Netlify CMSは記事DB兼画像などのアップロード先としてGitHubのリポジトリを利用します(GitLab、Bitbucketも対応)。また、ホスティング先はNetlifyのサーバーを無料で利用できます。</p>

<p>Hugo + Netlify CMSの組み合わせなら、WebからワンクリックでGitHubへのインストール、およびNetlifyへのデプロイが可能です。今回はブログの作成、およびブログテーマの切り替え、そして簡単な投稿ができるまでを目安にやってみます。</p>

<h1 id="hugo-netlify-cmsでブログを立ち上げる">Hugo + Netlify CMSでブログを立ち上げる</h1>

<p>HugoとNetlify CMSを使う場合、記事の投稿ができる状態のブログをあっという間に作成できる<a href="https://www.netlifycms.org/docs/start-with-a-template/">スターターテンプレート</a>を利用できます。ボタンを押すと自動でGitHubのリポジトリ作成＆Netlify CMS設定＆Netlifyのホスティング連携までやってくれてブログ環境が瞬時に出来上がるので非常に楽です。</p>

<h1 id="セットアップ">セットアップ</h1>

<p>Netlifyのアカウントを取得した上で、<a href="https://www.netlifycms.org/docs/start-with-a-template/">スターターテンプレート</a>のページで「Hugo Site Starter」のところの「Deply to netlify」ボタンを押します。</p>

<p><img src="/post/2018-08-31/01.jpg" alt="/post/2018-08-31/01.jpg" /></p>

<p>デプロイ元のリポジトリを接続する画面になるので、右下の「Connect to GitHub」を押します。</p>

<p><img src="/post/2018-08-31/990a6ac5.png" alt="990a6ac5.png" /></p>

<p>接続が終わると下記の画面に。リポジトリ名を入力して「Save &amp; Deply」を押す。</p>

<p><img src="/post/2018-08-31/260c459d.png" alt="260c459d.png" /></p>

<p>以上でほぼ完了。あとはGitHubのリポジトリに必要なファイル諸々が設置され、その後Netlify側にホスティングされます。</p>

<p><img src="/post/2018-08-31/91bd6286.png" alt="91bd6286.png" /></p>

<p>Netlify側のサイト名はランダムで決められているのでSite Settings→Change Site Nameにて修正しておくと良いでしょう。カスタムドメイン設定が必要ならDomain Settingsから行います。</p>

<h1 id="ブログできた">ブログできた</h1>

<p>諸々処理が完了すると、ブログが完成。</p>

<p><img src="/post/2018-08-31/721ecce8.png" alt="721ecce8.png" /></p>

<p>デフォルトでは謎のコーヒーファーム的テンプレートが使用されているので、修正が必要です。とりあえずテーマだけでも切り替えたいところ。</p>

<h1 id="デザインを変えてみる">デザインを変えてみる</h1>

<p>とりあえず適当なHugoテーマを取ってきて適用してみましょう。</p>

<p>まずはサイトのリポジトリをclone。</p>

<pre><code class="language-bash">&gt; git clone git@github.com:YOURACCOUNT/YOURREPOSITORY
</code></pre>

<p>今回は、ミニマル、かつコードハイライトにも対応していていい感じのHugoテーマ<a href="/post/2018-08-31/https://themes.gohugo.io/hugo-bingo/">Hugo Bingo</a>をありがたく使わせていただきます。Netlifyで作成したサイトにはthemesディレクトリがないので作成してからBingoのテーマを突っ込みます。</p>

<pre><code class="language-bash">netlifycms_dir&gt; cd site
netlifycms_dir&gt; mkdir themes
netlifycms_dir&gt; cd themes/
themes&gt; git clone git@github.com:gundamew/hugo-bingo.git
themes&gt; rm -rf hugo-bingo/.git/
</code></pre>

<p>site直下のlayoutsディレクトリを削除しないとうまくhugo-bingoを適用してくれないようなので、layoutsを消しつつ、設定ファイルとコンテンツもhugo-bingo/exampleSiteに入っているサンプルファイルを設置します。exapmleSite内のconfig.tomlとcontentをsite直下に上書き。content内のディレクトリ名「posts」はNetlify CMSの設定ファイルと食い違うので「post」に直しておきます。</p>

<pre><code class="language-bash">site&gt; rm -r layouts
site&gt; cp themes/hugo-bingo/exapmleSite/config.toml config.toml
site&gt; cp -r themes/hugo-bingo/exampleSite/content . 
site&gt; mv content/posts content/post
</code></pre>

<p>あとは、日本語対応のためconfig.tomlも微修正しておきましょう。<code>languageCode = &quot;zh-cmn-Hant&quot;</code>は削除した上で、下記を追記します。</p>

<pre><code class="language-toml:config.toml">isCJKLanguage = true
languageCode = &quot;ja-jp&quot;
</code></pre>

<p>これでtheme（とコンテンツ）がhugo-bingoにおきかわったはず。<code>hugo server</code>でローカルのWebサーバーが立ち上がるので、それで確認してみましょう。</p>

<pre><code class="language-bash">site&gt; hugo server
                   | EN
+------------------+----+
  Pages            | 11
  Paginator pages  |  0
  Non-page files   |  0
  Static files     | 54
  Processed images |  0
  Aliases          |  0
  Sitemaps         |  1
  Cleaned          |  0

Total in 150 ms
Watching for changes in /Users/yu/blog/yurik-hugo/site/{content,data,static,themes}
Watching for config changes in /Users/yu/blog/yurik-hugo/site/config.toml
Serving pages from memory
Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
Web Server is available at //localhost:1313/ (bind address 127.0.0.1)
Press Ctrl+C to stop
</code></pre>

<p>Webブラウザーで<a href="http://localhost:1313">http://localhost:1313</a> にアクセスしてみます。</p>

<p><img src="/post/2018-08-31/091f0014.png" alt="091f0014.png" />
できた。</p>

<p>Netlify CMSのヘルプページには「netlify identityのウィジェットをheadに追記せよ」とあるので、そうしましょう。
下記のようにhead.htmlの6行目に入れてみました。</p>

<pre><code class="language-html:hugo-bingo/layouts/partial/head.html">&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;
    &lt;title&gt;{{ with .Page.Title }}{{ . }} - {{ end }}{{ .Site.Title }}&lt;/title&gt;
    &lt;base href=&quot;{{ .Site.BaseURL }}&quot;&gt;
    &lt;script src=&quot;https://identity.netlify.com/v1/netlify-identity-widget.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ &quot;css/normalize.min.css&quot; | absURL }}&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ &quot;css/solarized-light.min.css&quot; | absURL }}&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ &quot;css/style.css&quot; | absURL }}&quot;&gt;
&lt;/head&gt;

</code></pre>

<p>早速GitHubにpushしてみます。</p>

<pre><code class="language-bash">netlifycms_dir&gt; git add .
netlifycms_dir&gt; git commit -m &quot;themeをhugo-bingoに変更&quot;
netlifycms_dir&gt; git push origin master
</code></pre>

<p>GitHubにpushすると、それを検知してNetlifyで自動デプロイしてくれます。デプロイが終わってからサイトのURLを叩くと無事サイトが表示されました。</p>

<p><img src="/post/2018-08-31/984829a7.png" alt="984829a7.png" /></p>

<p>CMS管理画面にもログインしてみます。
URLは「<code>hoge.com/admin/</code>」です。</p>

<p>ログイン画面が表示され、netlify identityでログインせよと言われますね。netlifyのアカウントでログインを試みるが、弾かれます。</p>

<p>結論から言うと、netlify identityのアカウントとnetlifyのアカウントは別物です。netlifyの管理画面からパスワードリセットのメールが送信できるので、そこからパスワードを設定しましょう。</p>

<p>サイト管理画面から「Identyty」を選び、
<img src="/post/2018-08-31/08606285.png" alt="08606285.png" /></p>

<p>自分のidentityをクリック
<img src="/post/2018-08-31/6d73dbdb.png" alt="6d73dbdb.png" /></p>

<p>Send reset password emailをクリック
<img src="/post/2018-08-31/11e8ae54.png" alt="0fece4a6.png" /></p>

<p>送信されてきたメールに記載のURLにアクセスするとパスワード変更できる
<img src="/post/2018-08-31/57e17e9b.png" alt="57e17e9b.png" /></p>

<p>ログインできました。</p>

<p><img src="/post/2018-08-31/eaadffb2.png" alt="eaadffb2.png" /></p>

    </section>
</main>

        </div><footer>
    <span class="footer-text">Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
</footer>
<script src="https://blog.yuri-k.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-833207-7', 'auto');
	
	ga('send', 'pageview');
}
</script>
</body>
</html>
